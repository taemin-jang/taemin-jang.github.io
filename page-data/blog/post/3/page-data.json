{"componentChunkName":"component---src-template-blog-post-js","path":"/blog/post/3/","result":{"data":{"markdownRemark":{"tableOfContents":"<ul>\n<li>\n<p><a href=\"#http-cache\">HTTP Cache</a></p>\n<ul>\n<li>\n<p><a href=\"#cache%EB%8A%94-%EC%99%9C-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EA%B2%83%EC%9D%BC%EA%B9%8C\">Cache는 왜 사용하는 것일까?</a></p>\n</li>\n<li>\n<p><a href=\"#cache%EA%B0%80-%EC%A3%BC%EB%8A%94-%EC%9D%B4%EC%A0%90%EB%93%A4\">Cache가 주는 이점들</a></p>\n</li>\n<li>\n<p><a href=\"#http-cache-%EC%A2%85%EB%A5%98\">HTTP Cache 종류</a></p>\n</li>\n<li>\n<p><a href=\"#worker\">Worker?</a></p>\n<ul>\n<li><a href=\"#web-worker\">Web worker</a></li>\n<li><a href=\"#shared-worker\">Shared worker</a></li>\n<li><a href=\"#service-worker\">Service worker</a></li>\n<li><a href=\"#%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%9B%8C%EC%BB%A4-%EC%BA%90%EC%8B%9C\">서비스 워커 캐시</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%BA%90%EC%8B%B1-%EB%A0%88%EC%9D%B4%EC%96%B4\">캐싱 레이어</a></p>\n<ul>\n<li><a href=\"#%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%9B%8C%EC%BB%A4-%EC%BA%90%EC%8B%B1\">서비스 워커 캐싱</a></li>\n<li><a href=\"#%EC%8B%A4%EC%A0%9C-%EC%8B%A4%ED%96%89%ED%95%B4%EB%B3%B4%EA%B8%B0\">실제 실행해보기</a></li>\n<li><a href=\"#%EB%8F%99%EC%9E%91-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%EC%A0%95%EB%A6%AC\">동작 시나리오 정리</a></li>\n<li><a href=\"#%EC%A3%BC%EC%9D%98%EC%82%AC%ED%95%AD\">주의사항</a></li>\n<li><a href=\"#%EC%B0%B8%EA%B3%A0\">참고</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>","html":"<h1 id=\"http-cache\">HTTP Cache</h1>\n<p>자주 쓰이는 리소스를 나중에 사용하기 위해 사본으로 저장하고, 나중에 동일한 요청을 했을 때, 캐시된 사본이 존재한다면 서버로 요청을 보내는 것이 아닌 Cache로부터 제공 된다. (⇒ 캐싱)</p>\n<h2 id=\"cache는-왜-사용하는-것일까\">Cache는 왜 사용하는 것일까?</h2>\n<p>네트워크에 대해 이해하고 있어야한다.</p>\n<p>네트워크를 통해서 리소스를 가져오는 것은 느리고 비용이 많이 든다.</p>\n<p>클라이언트가 자주 쓰는 페이지가 존재한다면 해당 페이지에 접속할 때마다 항상 서버로부터 요청을 보내고 서버는 같은 리소스를 클라이언트에게 매 번 보내야한다.</p>\n<p>그러면 클라이언트는 매 번 해당 페이지를 이용할 때마다 UX적으로 느린 경험을 할 수 밖에 없다.</p>\n<p>또한 서버도 비용이 많이드는 리소스를 매 번 전달해야하므로 서버측에서도 부담이 많이 된다.</p>\n<p>이러한 문제점을 해결하기 위해 캐시를 사용하는 것이다.</p>\n<p>캐시를 이용하면 서버와 클라이언트 둘 다 이점을 볼 수 있다. 대부분 trade-off가 적용되는데 캐시는 trade-off가 적용되지 않는다.</p>\n<h2 id=\"cache가-주는-이점들\">Cache가 주는 이점들</h2>\n<ol>\n<li>불필요한 데이터 전송을 줄여 네트워크 비용 감소</li>\n<li>네트워크 병목현상과 거리로 인한 지연시간을 줄여 웹 페이지를 빠르게 불러옴으로써 UX 증가</li>\n<li>서버에 대한 요청을 줄여 서버의 부하 감소</li>\n<li>갑작스런 요청 쇄도에 대처 가능</li>\n</ol>\n<h2 id=\"http-cache-종류\">HTTP Cache 종류</h2>\n<p>클라이언트에서 HTTP 요청을 보내면, 해당 요청을 바로 서버로 전송하지 않고 캐시된 데이터가 존재하는지 확인한다.</p>\n<p>캐시는 차례대로 서비스 워커 캐시 → 브라우저 캐시 → 프록시 캐시 (CDN) 순으로 확인 후 유효한 응답 값이 없을 경우 서버에 요청을 보내고 응답을 받게 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ff844dd7583b32d67caca70fb827a600/8bd7c/http_cache_flow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC8klEQVR42k2T2XPbRBjA9RfzSDtT+lKmwPDATBsmg2kDSdwcdkygNm6gtomcyUHoQOpDPmJZsm7Jsm5ptdJqdxl7KNPfw/fwHfPdjO/7SZJQShFCWZYBAOI49n0/DMPgA1EUAQAymOU5omvIRlIGAJCmKaUUwkwUF2EUr1aurGiabiiKpqi6JCmmtQzDeKELfhRggukHmDRNoyhKkiQI/JcvSs7KjEIvjtwCwU0GTCkmBFFa3EwahjN1YztbmzbBsiwPBn3LDpbiH8btJ/n8aXb/ZHH9cMZ+yl88EC4fCJcP0+kTLDz1uM+X8jtr6Zim4TgOLjCTZRlM0xQWNNdn77bVQRkavylcTR6eLAZVdVSbvz8OpV9dpdrr/SjOeZ6fr2zbNEyUI6YoCoQQhOtKGo3mzfVtkkDX8REqCowRKlBRUEItX7+advSVsvSMPM+zLCOEMIqiTKbTOT+bSebj7V++Orp5yWrPXg+fvx5uNbitOve8zpVai63mpNJ9L2h2GAR+EEAIEUKM53mmZbmOPV0YZVb6uvr3Tlv4/my8Xe9tNwbf1nulN6MfzsVv6q3bvjgZcePxpN/vW5aVpilDPyLL4MGrfUkQNFlamsbKMkPfW6+V4OtpU7UX5koHIElTCAAoioKJN0AIMcZxHO+Uy3YQRimEqECE5pggQjOM2fEbAGOYp2s1IRjjdc8QQsdxbNv2bFvnuPKXX9gXF+7V5bLLSq23Jnu+7LIrtjt8e2rc3TmiGMWx73kAAIwxgxCSJOn+/l5WVWM2448Oe6XvpGpFPqkO93bFypFWq/X3S3e/N8aD0ag/FObCnJ+rigoAYAgh7oYgCPM89zzvxc6O7Ti6aRiWqRqa5wac9s/d4sr2LW99eQUuMEKIYMJs5rE+dJ7nDw8P9/f2Pnv0qHpc+alW+/n0tFY7qRwdl1/tlg92ywf7f/5187//f48RRRGlVFGUZrPZbrc7nU6r1WJZttvtsufnrQ2ddvvs7Gw0Gn0c/C/bdRIQkEiEZgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Http Cache Flow\"\n        title=\"\"\n        src=\"/static/ff844dd7583b32d67caca70fb827a600/0a47e/http_cache_flow.png\"\n        srcset=\"/static/ff844dd7583b32d67caca70fb827a600/8a4e8/http_cache_flow.png 150w,\n/static/ff844dd7583b32d67caca70fb827a600/5a46d/http_cache_flow.png 300w,\n/static/ff844dd7583b32d67caca70fb827a600/0a47e/http_cache_flow.png 600w,\n/static/ff844dd7583b32d67caca70fb827a600/8bd7c/http_cache_flow.png 845w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"worker\">Worker?</h2>\n<h3 id=\"web-worker\">Web worker</h3>\n<p>JavaScript를 백그라운드에서 실행할 수 있는 쓰레드를 생성하는 기술</p>\n<p>웹 워커는 UI 쓰레드와 별개로 존재하므로 DOM에 접근할 수 없지만 자체적인 Global scope에서 Window scope와 같은 기능을 제공하기 때문에 지원 가능하다.</p>\n<h3 id=\"shared-worker\">Shared worker</h3>\n<p>윈도우 창이나 Iframe, worker등의 다른 브라우징 컨텍스트에서도 접근이 가능하다.</p>\n<p>특정 사이트에 로그인 후 중간에 어떤 탭에서 로그아웃 하면 Shared worker에서 자신을 참조하고 있는 모든 브라우저 컨텍스트에 메시지를 보내 다른 탭에 잇는 로그인 된 사이트도 로그아웃 시킨다.</p>\n<p>(이 경우가 두 개의 탭을 동일한 사이트에서 로그인 했을 때 한 쪽에서 로그아웃 하면 다른 탭도 로그아웃 되는 현상)</p>\n<h3 id=\"service-worker\">Service worker</h3>\n<p>다른 문서나 소스로부터 발생되는 이벤트에 대응하기 위한 이벤트 Driven 방식이며 이벤트 기반 워커로서 JavaScript 파일의 형태를 갖고 있다.</p>\n<p>네트워크 요청을 가로채서 네트워크 사용 가능 여부에 따라 적절한 행동을 취하고, 서버 리소스를 업데이트 할 수 있다.</p>\n<p>지속적인 백그라운드 프로세싱을 위해 새 런타임을 생성하는 것이 아니라 설치하는 방식이다.</p>\n<p>웹 페이지와 별개로 존재하므로 DOM이나 Window 요소에 접근 불가하며 비동기적으로 설계되어 XHR이나 웹 저장소 등의 API를 서비스 워커 내에서 사용할 수 없다.</p>\n<p>비동기로 설계되어 서비스 워커는 JavaScript 서비스와 다른 스레드에서 동작하므로 블로킹하지 않는다.</p>\n<ul>\n<li>Service worker의 역할 및 기능\n<ul>\n<li>네트워크 프록시 역할</li>\n<li>오프라인 웹을 구현하기 위해 캐시 활용 가능</li>\n<li>브라우저 창이 닫힌 상태(백그라운드)에서도 동작하므로 푸시 알림 구현 가능</li>\n<li>채팅 혹은 사진 업로드 기능 사용 중 컴퓨터가 오프라인 상태가 되는 경우 인터넷이 다시 연결됐을 때 메시지 전송을 실패하지 않는 백그라운드 동기화 가능</li>\n<li>리소스를 세부적으로 캐싱 가능</li>\n<li>보안 상의 이유로 HTTPS 통신이 가능한 서버에서만 동작 가능 (Localhost 제외)\n<ul>\n<li>네트워크 요청을 수정할 수 있어 중간자 공격(Man In The Middle : MITM)에 취약\n<blockquote>\n<p>중간자 공격(Man In The Middle : MITM) :\r\n공격자가 사용자의 인터넷 서버와 해당 인터넷 트래픽의 목적지 사이에 끼어들어 데이터 전송을 가로채는 공격이다. 꼭 사용자와 인터넷 서버간이 아니더라도 사용자와 사용자 간에서도 데이터를 가로챌 수 있다.\r\n자세한 내용 참고\r\n<a href=\"https://nordvpn.com/ko/blog/mitm/\">https://nordvpn.com/ko/blog/mitm/</a></p>\n</blockquote>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Life Cycle\r\nRegistration → Install → Activate → Idle → Fetch</li>\n<li>Service worker state\n<ul>\n<li>Installing</li>\n<li>Installed</li>\n<li>Activating</li>\n<li>Activated</li>\n<li>Redundant</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"서비스-워커-캐시\">서비스 워커 캐시</h3>\n<p>서비스 워커에서 fetch 이벤트 핸들러를 만들고 네트워크 요청을 가로채서 네트워크가 아닌 서비스 워커의 캐시에서 확인하고 반환한다.</p>\n<h2 id=\"캐싱-레이어\">캐싱 레이어</h2>\n<h3 id=\"서비스-워커-캐싱\">서비스 워커 캐싱</h3>\n<p>서비스 워커는 네트워크 유형의 HTTP 요청을 가로채고 캐싱 전략을 사용하여 브라우저에 반환되어야 하는 리소스를 결정한다.</p>\n<p>서비스 워커 캐시와 HTTP 캐시는 일반 용도로 사용되지만 서비스 워커 캐시가 정확히 무엇을 캐시하고 어떻게 캐싱하는지에 대해 알아보자</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/44bd2ebb3fb981bde6e61e476e44fc0f/8bd7c/service_worker_flow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB40lEQVR42k1Ry27aUBD1n7FJlW5BbPgDov5Bs0i3rJoPKBtwszEokMopEiBTFdMWlYcMZAciNrYB2+Dnxdj33qlMJMpZjTRzzpwzwwiCUK/XOY4bDAYAEBOM4gjFURBHRxwDQBRFpVKJ47jFYkEphQswoij+6fd/9371/vanhr4OPM13ZNfWA1f1HO3gj15mDw9fyyxbKBQsywKAswQzHA6n0+l8Ppdmsz0KAAATono2TUBioAv59f7z/USSWq2WYRjJAMaEEEopI8uyrmkbY6voOgAQSgkhcKJiQgBgslW/t5qTsaSfBs5IyMcoajw/j2bTTYSOcRLSsixFUVRVBUKNMHjZqO1m81v9aTwanzTper1WFAUhxACAqqqKLC+83T467K1dPp/PZrPpTKb3s6scPNnZhUFgmqbjuAAQBP6nu7uPt7fFYpE524gwfkXuj8now81NKpXKpNOV2qOFjxjjJOdpJwCYllWpVh3HqVarzJv75Din3mql5nK5q6t376+vq4+PLuCN75nIX7m2e0AG0H6t0i1+oQD1Wu3/ZgoJ2fc8QeiUyyzLsqZpHgi2Q2QgX/ZsE/l2HBlbvdtotNptsdtlLq8HAJIkiaIoCB2e5zudThiGl499KzRN43l+uVz+A6QVCmjw31goAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Service Worker Flow\"\n        title=\"\"\n        src=\"/static/44bd2ebb3fb981bde6e61e476e44fc0f/0a47e/service_worker_flow.png\"\n        srcset=\"/static/44bd2ebb3fb981bde6e61e476e44fc0f/8a4e8/service_worker_flow.png 150w,\n/static/44bd2ebb3fb981bde6e61e476e44fc0f/5a46d/service_worker_flow.png 300w,\n/static/44bd2ebb3fb981bde6e61e476e44fc0f/0a47e/service_worker_flow.png 600w,\n/static/44bd2ebb3fb981bde6e61e476e44fc0f/8bd7c/service_worker_flow.png 845w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>서비스 워커는 이벤트 리스너(일반적으로 fetch 이벤트)로 HTTP 요청을 가로채게 된다.</p>\n<p>이미지를 보면 <a href=\"https://developer.chrome.com/docs/workbox/modules/workbox-strategies/#cache-first-cache-falling-back-to-network\">Cache-FIrst 캐싱 전략</a>으로 캐시 데이터를 먼저 확인하여 불필요한 HTTP 요청을 줄여준다.</p>\n<p>서비스 워커의 사용법 (Life Cycle)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cdc111a2d5ac4690f7f6f491138c6794/8bd7c/service_worker_lifecycle.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACEklEQVR42oXO22vUQBQG8PzPgg+C+CDe6IvPri8VlQXRBxG1VAVvFLvVdjfZxKTdJpPrJHPLzCSTSZtkZXdpEUT64ztPh8N3DEKw758u/4MxFkURhDDLsjRNh2H4e2vkmC/CjFXtJrRqeX12uY7j2HVdbw0AwC5QSpVShhuyfTc3AZ8F5Swopz77HfPLAsuy9vb2JmuO47iu6ziObdumZaZpaoBCWUBYgG9iBqWbiM1x3/chCAjBjNGyZAQjRoluVN93laziKDICWM98vr5fxQyEm8hN8TAMEGJMBMJlCnEKMSJC6W46tc3FUVZAw4fC9AsbEBtgG5B5gL2YX3zd82iXnoxDc3z47en8x3N4/IZH7x8/vP764626PDAQIQAEWZYRQvIiz1eTdC0fOtW3CNtb6c+b2eHtYnaHzO+qkwfavz9+dO3DpxtV9tKQkidxaB7NgB8kYVRVLUu+l95IBmPtj3i2S4WmpKS4LBDOMUIYiUprXVb4i5EisgAggQWiFFHGpIxyZFqO7SwQDHn4gqE554JSRghFBaGE5PCkyA8kfGdQoTMiMypTIlMsEsSLsj5rtdZNo6qOfmXRjue5hyu/PO8YF+n26N7bz1s1nxrLq3RdJ9Y450KIruuebD/b2X/VdsoYlst/c6lRdSWFWmuaRkqpGjWZTE5D9+y8vaJZay2lFEJIKeu6rtaaFX1+3v0BPLDGnW4RLxsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Service Worker Life Cycle\"\n        title=\"\"\n        src=\"/static/cdc111a2d5ac4690f7f6f491138c6794/0a47e/service_worker_lifecycle.png\"\n        srcset=\"/static/cdc111a2d5ac4690f7f6f491138c6794/8a4e8/service_worker_lifecycle.png 150w,\n/static/cdc111a2d5ac4690f7f6f491138c6794/5a46d/service_worker_lifecycle.png 300w,\n/static/cdc111a2d5ac4690f7f6f491138c6794/0a47e/service_worker_lifecycle.png 600w,\n/static/cdc111a2d5ac4690f7f6f491138c6794/8bd7c/service_worker_lifecycle.png 845w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>\n<p>Registration (등록)</p>\n<ul>\n<li>\n<p>index.html 파일 script 태그 안에 <code>navigator.serviceWorker.register()</code>메서드를 사용해 서비스 워커를 등록한다.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"857200940280056200\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"복사했습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`<!DOCTYPE html>\r\n<html lang=&quot;en&quot;>\r\n  <head>\r\n    <meta charset=&quot;UTF-8&quot; />\r\n    <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; />\r\n    <title>mySite</title>\r\n  </head>\r\n  <body>\r\n    <h1>Test</h1>\r\n    <script>\r\n      const registerServiceWorker = async () => {\r\n        // 브라우저에서 서비스 워커를 지원하는지 체크\r\n        if (&quot;serviceWorker&quot; in navigator) {\r\n          try {\r\n            console.log(&quot;서비스 워커 지원&quot;);\r\n\r\n            // 등록된 서비스 워커 지우기\r\n            navigator.serviceWorker.getRegistrations().then((r) => {\r\n              r[0].unregister();\r\n            });\r\n\r\n            // 현재 등록된 서비스 워커 확인\r\n            navigator.serviceWorker\r\n              .getRegistrations()\r\n              .then((res) => console.log(&quot;등록된 서비스 워커&quot;, res));\r\n\r\n            // 서비스 워커 등록\r\n            const registration = await navigator.serviceWorker.register(\r\n              &quot;./service-worker.js&quot;\r\n            );\r\n            console.log(registration);\r\n            if (registration.installing) {\r\n              console.log(&quot;Service worker installing&quot;);\r\n            } else if (registration.waiting) {\r\n              console.log(&quot;Service worker installed&quot;);\r\n            } else if (registration.active) {\r\n              console.log(&quot;Service worker active&quot;);\r\n            }\r\n          } catch (error) {\r\n            console.error(\\`Registration failed with \\${error}\\`);\r\n          }\r\n        }\r\n      };\r\n\r\n      registerServiceWorker();\r\n    </script>\r\n  </body>\r\n</html>`, `857200940280056200`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg stroke=\"currentColor\" fill=\"none\" stroke-width=\"2\" viewBox=\"0 0 24 24\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"h-4 w-4\" height=\"1em\" width=\"1em\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2\"></path><rect x=\"8\" y=\"2\" width=\"8\" height=\"4\" rx=\"1\" ry=\"1\"></rect></svg>\n              </div>\n            </div>\n<deckgo-highlight-code language=\"html\" terminal=\"carbon\" theme=\"blackboard\"  >\n          <code slot=\"code\">&lt;!DOCTYPE html&gt;\r\n&lt;html lang=&quot;en&quot;&gt;\r\n  &lt;head&gt;\r\n    &lt;meta charset=&quot;UTF-8&quot; /&gt;\r\n    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;\r\n    &lt;title&gt;mySite&lt;/title&gt;\r\n  &lt;/head&gt;\r\n  &lt;body&gt;\r\n    &lt;h1&gt;Test&lt;/h1&gt;\r\n    &lt;script&gt;\r\n      const registerServiceWorker = async () =&gt; {\r\n        // 브라우저에서 서비스 워커를 지원하는지 체크\r\n        if (&quot;serviceWorker&quot; in navigator) {\r\n          try {\r\n            console.log(&quot;서비스 워커 지원&quot;);\r\n\r\n            // 등록된 서비스 워커 지우기\r\n            navigator.serviceWorker.getRegistrations().then((r) =&gt; {\r\n              r[0].unregister();\r\n            });\r\n\r\n            // 현재 등록된 서비스 워커 확인\r\n            navigator.serviceWorker\r\n              .getRegistrations()\r\n              .then((res) =&gt; console.log(&quot;등록된 서비스 워커&quot;, res));\r\n\r\n            // 서비스 워커 등록\r\n            const registration = await navigator.serviceWorker.register(\r\n              &quot;./service-worker.js&quot;\r\n            );\r\n            console.log(registration);\r\n            if (registration.installing) {\r\n              console.log(&quot;Service worker installing&quot;);\r\n            } else if (registration.waiting) {\r\n              console.log(&quot;Service worker installed&quot;);\r\n            } else if (registration.active) {\r\n              console.log(&quot;Service worker active&quot;);\r\n            }\r\n          } catch (error) {\r\n            console.error(`Registration failed with ${error}`);\r\n          }\r\n        }\r\n      };\r\n\r\n      registerServiceWorker();\r\n    &lt;/script&gt;\r\n  &lt;/body&gt;\r\n&lt;/html&gt;</code>\n        </deckgo-highlight-code>\n</li>\n</ul>\n</li>\n<li>\n<p>Install (설치)</p>\n<ul>\n<li>사이트 첫 방문 시 Install 이벤트 발생 후 페이지 캐싱</li>\n<li>Install 리스너에서 캐시 초기화 후 오프라인 사용을 위해 파일들 추가</li>\n<li>캐시 이름을 저장할 변수를 생성하고, 파일들을 하나의 배열에 저장</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"17002797473763410000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"복사했습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`// service_worker.js\r\n\r\n// 서비스 워커 설치\r\nself.addEventListener(&quot;install&quot;, (pEvent) => {\r\n  console.log(&quot;(install)서비스워커 설치 중&quot;);\r\n\r\n  // 설치 완료되면 waitUntil 실행\r\n  pEvent.waitUntil(\r\n    // 캐시 변수 cacheName1 생성 후 cache.addALL() 메서드로 파일들을 하나의 배열로 저\r\n    caches\r\n      .open(&quot;cacheName1&quot;)\r\n      .then((cache) => cache.addAll([&quot;/test.png&quot;, &quot;/test.ico&quot;]))\r\n  );\r\n});`, `17002797473763410000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg stroke=\"currentColor\" fill=\"none\" stroke-width=\"2\" viewBox=\"0 0 24 24\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"h-4 w-4\" height=\"1em\" width=\"1em\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2\"></path><rect x=\"8\" y=\"2\" width=\"8\" height=\"4\" rx=\"1\" ry=\"1\"></rect></svg>\n              </div>\n            </div>\n<deckgo-highlight-code language=\"js\" terminal=\"carbon\" theme=\"blackboard\"  >\n          <code slot=\"code\">// service_worker.js\r\n\r\n// 서비스 워커 설치\r\nself.addEventListener(&quot;install&quot;, (pEvent) =&gt; {\r\n  console.log(&quot;(install)서비스워커 설치 중&quot;);\r\n\r\n  // 설치 완료되면 waitUntil 실행\r\n  pEvent.waitUntil(\r\n    // 캐시 변수 cacheName1 생성 후 cache.addALL() 메서드로 파일들을 하나의 배열로 저\r\n    caches\r\n      .open(&quot;cacheName1&quot;)\r\n      .then((cache) =&gt; cache.addAll([&quot;/test.png&quot;, &quot;/test.ico&quot;]))\r\n  );\r\n});</code>\n        </deckgo-highlight-code>\n</li>\n<li>\n<p>Activate (활성화)</p>\n<ul>\n<li>기존 서비스 워커가 없으면 설치를 시도하고, 설치를 성공하면 활성화한다.</li>\n<li>만약 기존에 서비스 워커가 존재한 경우, 새로운 버전을 백그라운드에서 설치하지만 아직 활성화는 하지 않는다. 이 시점의 워커를 <code>대기 중인 워커</code>라고 부르며, 대기 중인 워커는 이전 버전의 서비스 워커를 사용하는 페이지가 모두 닫힌 후에 활성화가 되고 이를 <code>활성 워커</code>라고 한다.</li>\n<li>활성화 절차를 더 빨리 하려면 <code>ServiceWorkerGlobalScope.skipWaiting()</code>을 사용할 수 있고, 새로운 활성 워커는 <code>Clients.claim()</code>을 사용해 이전 페이지를 회수할 수 있다.</li>\n<li>active 했을 때 과거의 캐시를 지우는 등 이전 서비스 워커 관련된 항목을 정리하면 좋다.</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"62133284971160486000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"복사했습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`// service-worker.js\r\n\r\n// 서비스 워커 활성화\r\nself.addEventListener(&quot;activate&quot;, (event) => {\r\n  // 캐시 허용 리스트\r\n  const cacheAllowlist = [&quot;v2&quot;];\r\n\r\n  // 활성화 되면 waitUntil 실행\r\n  event.waitUntil(\r\n    caches.keys().then((keyList) => {\r\n      Promise.all(\r\n        keyList.map((key) => {\r\n          // 이전에 생성한 캐시가 허용되지 않았다면\r\n          if (!cacheAllowlist.includes(key)) {\r\n            // 해당 캐시를 지웁니다.\r\n            return caches.delete(key);\r\n          }\r\n        })\r\n      );\r\n    })\r\n  );\r\n});`, `62133284971160486000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg stroke=\"currentColor\" fill=\"none\" stroke-width=\"2\" viewBox=\"0 0 24 24\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"h-4 w-4\" height=\"1em\" width=\"1em\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2\"></path><rect x=\"8\" y=\"2\" width=\"8\" height=\"4\" rx=\"1\" ry=\"1\"></rect></svg>\n              </div>\n            </div>\n<deckgo-highlight-code language=\"js\" terminal=\"carbon\" theme=\"blackboard\"  >\n          <code slot=\"code\">// service-worker.js\r\n\r\n// 서비스 워커 활성화\r\nself.addEventListener(&quot;activate&quot;, (event) =&gt; {\r\n  // 캐시 허용 리스트\r\n  const cacheAllowlist = [&quot;v2&quot;];\r\n\r\n  // 활성화 되면 waitUntil 실행\r\n  event.waitUntil(\r\n    caches.keys().then((keyList) =&gt; {\r\n      Promise.all(\r\n        keyList.map((key) =&gt; {\r\n          // 이전에 생성한 캐시가 허용되지 않았다면\r\n          if (!cacheAllowlist.includes(key)) {\r\n            // 해당 캐시를 지웁니다.\r\n            return caches.delete(key);\r\n          }\r\n        })\r\n      );\r\n    })\r\n  );\r\n});</code>\n        </deckgo-highlight-code>\n</li>\n<li>\n<p>Fetch</p>\n<ul>\n<li>서비스 워커 설치 후 fetch 요청을 감지 후 처리</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"61264993640296915000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"복사했습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`// service-worker.js\r\n\r\n// 요청이 올 때마다 가로채기\r\nself.addEventListener(&quot;fetch&quot;, (event) => {\r\n  console.log(&quot;fetch&quot;);\r\n  event.respondWith(\r\n    caches.match(event.request).then((response) => {\r\n      // request에 캐시가 있다면 반환\r\n      if (response) {\r\n        console.log(&quot;Found response in cache:&quot;, response);\r\n\r\n        return response;\r\n      }\r\n      console.log(&quot;No response found in cache. About to fetch from network…&quot;);\r\n\r\n      // 없으면 네트워크 fetch로 요청\r\n      return fetch(event.request)\r\n        .then((response) => {\r\n          console.log(&quot;Response from network is:&quot;, response);\r\n\r\n          return response;\r\n        })\r\n        .catch((error) => {\r\n          console.error(&quot;Fetching failed:&quot;, error);\r\n\r\n          throw error;\r\n        });\r\n    })\r\n  );\r\n});`, `61264993640296915000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg stroke=\"currentColor\" fill=\"none\" stroke-width=\"2\" viewBox=\"0 0 24 24\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"h-4 w-4\" height=\"1em\" width=\"1em\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2\"></path><rect x=\"8\" y=\"2\" width=\"8\" height=\"4\" rx=\"1\" ry=\"1\"></rect></svg>\n              </div>\n            </div>\n<deckgo-highlight-code language=\"js\" terminal=\"carbon\" theme=\"blackboard\"  >\n          <code slot=\"code\">// service-worker.js\r\n\r\n// 요청이 올 때마다 가로채기\r\nself.addEventListener(&quot;fetch&quot;, (event) =&gt; {\r\n  console.log(&quot;fetch&quot;);\r\n  event.respondWith(\r\n    caches.match(event.request).then((response) =&gt; {\r\n      // request에 캐시가 있다면 반환\r\n      if (response) {\r\n        console.log(&quot;Found response in cache:&quot;, response);\r\n\r\n        return response;\r\n      }\r\n      console.log(&quot;No response found in cache. About to fetch from network…&quot;);\r\n\r\n      // 없으면 네트워크 fetch로 요청\r\n      return fetch(event.request)\r\n        .then((response) =&gt; {\r\n          console.log(&quot;Response from network is:&quot;, response);\r\n\r\n          return response;\r\n        })\r\n        .catch((error) =&gt; {\r\n          console.error(&quot;Fetching failed:&quot;, error);\r\n\r\n          throw error;\r\n        });\r\n    })\r\n  );\r\n});</code>\n        </deckgo-highlight-code>\n  <details>\r\n    <summary>카카오 tech 블로그에서 사용한 예시</summary>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"blackboard\"  >\n          <code slot=\"code\">  ```html\r\n  &lt;!--index.html--&gt;\r\n  &lt;script&gt;\r\n  \t\t\t// ...\r\n  \t\t\t// 서비스 워커 등록 후 fetch 요청\r\n  \t\t\tregisterServiceWorker();\r\n        fetch(&quot;https://jsonplaceholder.typicode.com/users/1&quot;)\r\n          .then((response) =&gt; response.json())\r\n          .then((data) =&gt; console.log(data))\r\n          .catch((error) =&gt; console.log(error));\r\n  &lt;/script&gt;\r\n  ```\r\n  \r\n  ```jsx\r\n  self.addEventListener(&quot;fetch&quot;, function (event) {\r\n    const { method, headers, url } = event.request;\r\n    console.log(&quot;[SW] Fetch Method : &quot;, method);\r\n    console.log(&quot;[SW] Fetch Headers : &quot;, headers);\r\n    console.log(&quot;[SW] Fetch URL : &quot;, url);\r\n  });\r\n  ```\r\n  \r\n  &lt;/details&gt;</code>\n        </deckgo-highlight-code>\n</li>\n</ul>\n<h3 id=\"실제-실행해보기\">실제 실행해보기</h3>\n<ul>\n<li>\n<p>캐시 확인</p>\n<p>캐시 저장공간에 2개의 캐시를 생성했다. cache-v1과 cacheName이 있는데 activate 됐을 때 허용된 캐시만 남기고 허용되지 않은 캐시는 삭제되는지 테스트 해봤다. (허용되지 않은 캐시는 cacheName)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/259f5df8c3a0bb08a025e90d37ee1d55/33e10/service_worker_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABbklEQVR42o2SzU7dMBCF/f4vgZBY8RRQwYING1aVKBcc+yY3dvyTOD83dnzQuG2KKpAY6WgmjnLmm4mZcw5CCLRtixgjKFJKEEKiMw7Oe0zLgjCOmOYZYZxQNyfIukarNJpTW3JnLKz3YCEEKKXKh9u2FUMyPtY1dGfwxitUQpZ6nGasMaFVCr9eDlBaoxJH8EqWZuc1gnVdB+99oUp/DVNC3TTwfV+6K91hOZ930blSGv0Q4JyHMbYY0jumtYaUR5xOLdZ13QmJ+mPknPGdYNbassMQxv2QaKnRV5HxtTmjcTjnBf38h3DLGfM8f2pEpB9p/ydn3hk0kkO3NeK6ADkhb3FfMu2TfhaJdpwS1Xl/ppryGmMRu7gLuH7ocXXvcXFjcHmrcfnDgKtpH59oSdM0FdHNGMcR87yUeln+TcOeDg53j8/4KQYIu6EyqUjbAf0wwFgHeazBhQSvBLgQeDm87tfp9e13dr6H7we8A+omtEvPjliDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Service Worker 1\"\n        title=\"\"\n        src=\"/static/259f5df8c3a0bb08a025e90d37ee1d55/0a47e/service_worker_1.png\"\n        srcset=\"/static/259f5df8c3a0bb08a025e90d37ee1d55/8a4e8/service_worker_1.png 150w,\n/static/259f5df8c3a0bb08a025e90d37ee1d55/5a46d/service_worker_1.png 300w,\n/static/259f5df8c3a0bb08a025e90d37ee1d55/0a47e/service_worker_1.png 600w,\n/static/259f5df8c3a0bb08a025e90d37ee1d55/33e10/service_worker_1.png 844w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>성공적으로 허용되지 않은 캐시는 사라지는 것을 볼 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/649a9d03a91c8c0c0fd7eda889550d7e/99072/service_worker_2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACQElEQVR42p1U2W7jMAz0//9iHpImkS/dt205ngXpNttiHwqsgIEjhR4OxaG7YZowKw0XIrRxUMZCaQOlLcZZYZIa4zTj3ktcPgYMysE6jxAzUkqwWqKXAUprWO/RSaUgpUSpFV9r33c8hUA/TphmCWMdUl2Q6oqY65nQGGhjoa2Dc5QkwDiHjjbDMDApEdFq2wbR9wis2sL5wC+VUrGuGxM+hOAnJRT9gBATSl3QxRiRUmay4ziYcNu2M4k2uN3veDwFfIzItWLZNlZMZ1JpxlP0TLisG7rn84lxHGGtRWvtTThNE5Z15XsitH1/Y1lWxJhQlwXrtqGUgq01/q8jsvv9DqXUD4VSKvzP6tRnU6jk1+vFh+u6Ypby/wiJjFQaY95NIWIqk54EOv8NX7Hd7faBy+WC6/XK90YJCGejziC6it/wJtRaY54lnPegjvsQEEJgi7CFWkPwnm1jjIW1juPpqrx3bGiq7rWf19XRRgjBNqmf5qaM9CL5jOxAk0FWYSMbC6lOU1OM4TOHlMvpQzFKXB8jJil57BwpTJkngEbShgCf0l/EhJAzXIwcY3zgMTU+YlIG3UMMuD3OMZupjBCwLAtbh0Adp7K/Y98be5BUUgVk7g8hMU7qnBRrDLz3yDmjlsKmpbGLKSGXejbmdfzT9a9m4DggZ8kcHalRSmKeZwzDCGMtUowo1qF6h+ocsrV8v6SW4mkyyFb0O+eCWhduDDWzo69MTonV8Ii1dioiBYTWcHyzzo/1bXt+OFb8AcAS0o4eGiX6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Service Worker 2\"\n        title=\"\"\n        src=\"/static/649a9d03a91c8c0c0fd7eda889550d7e/0a47e/service_worker_2.png\"\n        srcset=\"/static/649a9d03a91c8c0c0fd7eda889550d7e/8a4e8/service_worker_2.png 150w,\n/static/649a9d03a91c8c0c0fd7eda889550d7e/5a46d/service_worker_2.png 300w,\n/static/649a9d03a91c8c0c0fd7eda889550d7e/0a47e/service_worker_2.png 600w,\n/static/649a9d03a91c8c0c0fd7eda889550d7e/99072/service_worker_2.png 842w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>캐시가 저장되고 삭제되는 것을 봤으니 오프라인 모드에서 동작하는지 확인해봐야죠</p>\n<p><img src=\"/d0b54b153df2f9777ced414f18079fe5/service_worker_execution.gif\" alt=\"Service Worker Execution\"></p>\n<p>네트워크 환경을 오프라인으로 변경 후 새로고침 하면 인터넷 연결 없음이 뜨지만</p>\n<p>이 후에 서비스 워커가 설치 및 서비스 워커가 실행되면서 캐시에 저장되어 있는 파일을 가져오게 되고 정상적으로 동작하는 것을 볼 수 있다.</p>\n</li>\n<li>\n<p>외부 url fetch로 호출 시 3초가 걸리도록 설정했다.\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 501px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7a9a9827c29d831621056a1d93499bb8/55811/service_worker_fetch_code.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACdklEQVR42pWTe3OaUBTE8RmrYkwAQURAUR6Xl6LNo6ZJmknSfv8v9OsA1nQ6zrT9Y+eceznszJ7dKw2dPYp7j7z4Qn/5QM8UmMkdl95ntPAWdb2lNxV0jBUNLaSh+jS0gMbkPKTePK8IZ8EbSv4dNb/Hu9ljZbcY6RuL/TtGdMBMDpjZE+PVHb15gTQJzxN2Zyk9q2C8ekT2nxmHB67dDf1ZzsD7grx6RPMfMMVXLt090+SA7KRIWkDzHKHsJvRmOU3VR7peICmlNB9JW1d9Da++V9fH6tc/n5EuKd4NqnfAyr9xtb5h4uZ0jIimEdI2BS0jom2I6q47FXSnEb2ZoDUJGJoBbb3c6foEqTff0ndvGS7vGXmfuZqn9PWYvrdhGO4YLHeMFwdUt0CPbhlYIWMnZmgKgnXEaO4jKUsaag1JdlPG9p6BueHTNOXCSGjrEZLmV9JPKOX8knaUejrrpUG1SVLfybDWL1wvHriYJnSMhKYW0tSj41BUD5Y71s5A9U/fapetjNYkQvdfuVy/YuTvGP4Ni+gFK37CLn5gigLZiZGdpMLITRjMY0bHs2wn9K30I4elW+pyTxA/MnYz7HiLusqwxBZHbLFEgRPvMMMCO97hJnXvJDvmcYEVFYzsDa1JiHRhZXTMiCsvZTQXVWBLuS1DVJJbekjbKGtQx0k5Qv2j/yW5JGybKdfJVwbhPePwGSN5QAnuGC0ybFGwSHbMxJaBE9WB1utQV/WIj5dS7tDMmaXvqPETk80PFHHg0surrNUuByen/4Zqh61ZQsfN6NopXWvD0M0Z2HEltxxq/gPRx9NztphRTKfMnlJn7ved/C9+AmgLitUfgz0vAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Service Worker Fetch code\"\n        title=\"\"\n        src=\"/static/7a9a9827c29d831621056a1d93499bb8/55811/service_worker_fetch_code.png\"\n        srcset=\"/static/7a9a9827c29d831621056a1d93499bb8/8a4e8/service_worker_fetch_code.png 150w,\n/static/7a9a9827c29d831621056a1d93499bb8/5a46d/service_worker_fetch_code.png 300w,\n/static/7a9a9827c29d831621056a1d93499bb8/55811/service_worker_fetch_code.png 501w\"\n        sizes=\"(max-width: 501px) 100vw, 501px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n캐시 비우기 및 강력 새로고침하면 아래 사진처럼 3초 뒤에 fetch 데이터를 호출한다.\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9c627aa133e38fb9cbc11da610b7acb9/e9beb/service_worker_prev_caching.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAA7DAAAOwwHHb6hkAAADE0lEQVR42o1Uya7jNhDU//9SrjnnkDkEyMy8jG1JFHdxk8RFqoBt+2UuA4RAoSmqLXdXVXP4+9sH7o+JIKTGOM2YFw6hNKaFY2QL7RchCY9ppii1wSIlHjPDODMoY+FCxLA6ByEVbtOIH2wCUxJHqVDGwDmHlDO246CctO2o7URKG7Q2yLnQs/eBnkupGEqtaK0ilg22BKQzo6993xGch9ws1lJwthO4LsQ9w6QVzCzgxwpXEvThoXaHtUQMtVac59VzcbULZ2voZ/Uda8V+HGjnSfuYDuTjwLFt2GtBrhW9qNIqci0YPu4zhJCwzmF1nlqb2YKFCzzGCVwq4pXeKQ2p9Gfe1PMWji8/vsJYB6EUhq8fI8bHAwvnSCkhhABrLUWtNcEYg9YajuNAbRXOefrQNM243274bmf8tXCUvWDQ0qAL0zkrpSDECB8CnPe0V0rjfr9Tu0fOz7ZjJBG4EIS+viwP/P74E4NTEtUa1H3HeV3Yg8fuVuwxYltmOPP8Ya0FpWS0syFvEUFyeM6wziPOC+BW47d//sCgjaEWjV3BuIDShvbE1eoods9pY8GFw8J/gghwZsXKGNy0oISMYVoEvt1mMjHrhjUWyqzPaB1Foc3rzEHoFVytWKQFVxZSWSghietFKgy3ccL3/kHGSd1eYQiRyO9GrS9b5FIInecujtSazN+VvY8zfjBLwg6dYCkFTG/VGBLnja76G+d5EvlXN+wrvvedGqUU/dlQa0OMCTFFUs97T6PUbdPRx2zbNjJyyfmJ7ogjk+F7tX1EuZDIOWPoCUoqCM6xMIZ5mkkkawxVHUNEihG7tYTDWuR1xd7PU8Lx6sQ7j9orzB8fcI8RhjHoaYJlDElpxH4ZKIWr+0zKJ0LsQ/6JFiPlmWnEfGOINmDopVfnPjm5zov4uv4n+iXgVgfdOaSWS0U7jv+Ixov0n4j/Fd5CdS9P80x8Dn1GtVAwUsCuHpvz2EJCihuq92jdQutKaCGgOYfmPXXVUqKqSECfkHPFUI+MNDEiu+SX90q/utqnLX613u+f3nzO+b+nc7Jf6SYJiAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Service Worker Prev Caching\"\n        title=\"\"\n        src=\"/static/9c627aa133e38fb9cbc11da610b7acb9/0a47e/service_worker_prev_caching.png\"\n        srcset=\"/static/9c627aa133e38fb9cbc11da610b7acb9/8a4e8/service_worker_prev_caching.png 150w,\n/static/9c627aa133e38fb9cbc11da610b7acb9/5a46d/service_worker_prev_caching.png 300w,\n/static/9c627aa133e38fb9cbc11da610b7acb9/0a47e/service_worker_prev_caching.png 600w,\n/static/9c627aa133e38fb9cbc11da610b7acb9/e9beb/service_worker_prev_caching.png 730w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n새로고침하면 캐시되어있는 데이터를 바로 가져오는 것을 볼 수 있다.\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4cefa4cc1dd7396ec96b9a10be59d69b/c54b3/service_worker_after_caching.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACx0lEQVR42o1T2W7cMAz0//9h0Waz2fWhW5blQ4ftKUhng+ShQGUQIiyKIoczza/fb3h/PPHxbDFIhUfb8a6MRTcIdIOEtg6D1JDaoBMSQmko42CsQ8sxAspaTPOCZlkWKGXweLQYxwDvRwghEcKEUiuc8zDGsh+mCUprpJxB9wYhMC8rUi5QSiOEiKbWin3fkXNGLQUH+SkhpQQ6e/mlFI5J24aSM0rJ2D59ur/4iOM40Gwpo+77ZXVHKRU5F+RSkFLmyraUcJwn+1RdqTv2/eCYul/n0Ue+13T9AG0s3DgizBHGOfSCcLMYPvf3jw9IrTmOzqd4xQ1SYlCKcQwxIkwRzb0zuN/f4ZzjFudlgfce8zxjGAZY6yCEgLUW27YixgghJeNstMHb2w1LutonXJu+k9DaMPCUhA7o0stoUFIp0KIW/ThCKg3/OcC+7y9MCd+U0DjjEUJgwBncZcU0RUzTxFXT2e12w7puKLVw9cNwVUx+23X8UGHMExrrPdPB+ZH5Z/3IvLtwDcw5MmNH9MOIXgT0MvA+qAnRGIS2RSAKrSuaXij8uXdfhDXOc1JKRm29/O9mfYAyHtp6JjdD5q5CmkfX4/e9RyfUNV1jeVpMnZw/959G1KEpU3f0wLPrcGsNK6khonrveBjruuI8DnxfJ/69ti3xHcLZGMMFNDQdIRSkVDDWw2uLeZy4kn1Zcawb9mXBHiPqvKDOM+/7PGNUCmIQkNSZtljXjIYqk1LzxCjhNE6IIbIulxixEZUoWUo494qT5FkrzlqBfedKaboxzqw01jIRkm299jjPzEFSBPlEpUvr9ZIoSe4L48yxJIKr5VKY1KQG+vl8tswxZx3jwgnnBZtzWL3HSopxHmuMLATCkLok3lKuJm0Zi3NfrxFJX+Pg77zs+nX+GNTrPyXruv4ids2VAf8x2fP8b6NFMGmtWX5/ARmDZs+DfdRZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Service Worker After Caching\"\n        title=\"\"\n        src=\"/static/4cefa4cc1dd7396ec96b9a10be59d69b/0a47e/service_worker_after_caching.png\"\n        srcset=\"/static/4cefa4cc1dd7396ec96b9a10be59d69b/8a4e8/service_worker_after_caching.png 150w,\n/static/4cefa4cc1dd7396ec96b9a10be59d69b/5a46d/service_worker_after_caching.png 300w,\n/static/4cefa4cc1dd7396ec96b9a10be59d69b/0a47e/service_worker_after_caching.png 600w,\n/static/4cefa4cc1dd7396ec96b9a10be59d69b/c54b3/service_worker_after_caching.png 727w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n</ul>\n<h3 id=\"동작-시나리오-정리\">동작 시나리오 정리</h3>\n<ol>\n<li>사용자가 처음 웹 서비스에 들어오면 서비스 워커가 설치됨.</li>\n<li>서비스 워커는 Cache Storage API를 이용해 정적 파일을 캐시에 저장.</li>\n<li>서비스 워커 설치 후 실행되면서 허용되지 않은 캐시가 있을 경우 삭제.</li>\n<li>이후 사용자가 요청을 보내면 서비스 워커에 의해 캐시 반환.\r\n⇒ 오프라인 환경에서도 서비스 워커 캐시를 반환하므로 정상 작동.</li>\n<li>만약 캐시에 해당 요청에 대한 반환 값이 없다면 HTTP 요청으로 전송</li>\n</ol>\n<h3 id=\"주의사항\">주의사항</h3>\n<ol>\n<li>\n<p>service worker는 https와 <a href=\"http://localhost\">localhost</a> 환경에서 동작 (본인은 express 환경에서 동작시킴)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8c8bf9c0a7f28d583580416279daadc0/e1031/service_worker_caution_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAARUlEQVR42jXKMQ6AIAxAUe9/vmpZaBsmDgAlGJPvYBze9o5xKVtOUAURnlJIEaZVphnpTtbKiGBFwM+dO+I75mRrrN55AZ9USdj2Xy1vAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Service Worker Caution 1\"\n        title=\"\"\n        src=\"/static/8c8bf9c0a7f28d583580416279daadc0/0a47e/service_worker_caution_1.png\"\n        srcset=\"/static/8c8bf9c0a7f28d583580416279daadc0/8a4e8/service_worker_caution_1.png 150w,\n/static/8c8bf9c0a7f28d583580416279daadc0/5a46d/service_worker_caution_1.png 300w,\n/static/8c8bf9c0a7f28d583580416279daadc0/0a47e/service_worker_caution_1.png 600w,\n/static/8c8bf9c0a7f28d583580416279daadc0/e1031/service_worker_caution_1.png 803w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>개발자도구 > 애플리케이션 > 좌측 탭에 Service Workers > 새로고침 시 업데이트 체크</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b6fdd58a142e8fa58866cb9338a62d88/c4b7c/service_worker_caution_2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 85.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACTklEQVR42n1Ua2/bMAz0//+B+zAUKJAmcZLasvWWqMcNpOPM3boZYIRI9Il3R3r4nGbMywLrPLSxmNWCaVZQyyKxaI1PpfF+eeChNIy1sjcphVUt0I8Rd2XwmBYs64phHG84n8/QWiPnDCKC0SvGx4xpcaCcEWJCzgTvAzIR/vX03jHcbje8vb3h4+MDSimEEJFihHURqw1I0YMoo5QiF26AHVQbXGqI1BDyFokahnVdYZ0T9P0WBnXWwVoHnztcBshH9EM1VDt06Nt52iLmhuF+v+N0OoHX3psA7uCtdazGQ2kHrQ2cc6iNc/5DeVkWjOModPZNfmqtcMHDOiOaskHGOhgbkOt/AOd5xuVyEVNaay9ANielJLT5jLtA2YSUsuxz7hGI2bS9wmmawMCc1A5abs56GGMlGJj/M3U2SfJbEzY+8towcBKDWmvlYLutCViI8QXI5zHGQ0XtGRUxV6y+IuWKgROZ8taL5qlfg/MBMUUBYdeNMQKeU0Qt9JJHmJSORB2ltA2Qe5EpszF70l4Bg3BwHpWKXLu0T//GajFl1Rrn80WamsUmKl+SeC+EINFbAZYfwPoT/WDKb8CGgQW+Xq94PD4RY0IhkkoZKMXN1c3xjEqEqt/RzEmqDdSQSxO6kZh2wcDasE67IRwxRKHonf+2kn1S1rBNiE37tDxHj0G5DWQ6DtpQKVIpayizTIRCWWadC/jzYc0HfuF6HcWU46Qw7ZiSvPjquaNh/WnOM16A/LOZQX+NXpZPV4Rz/tmPRqQQx4m+NHambf0FghEuSZCrTgwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Service Worker Caution 2\"\n        title=\"\"\n        src=\"/static/b6fdd58a142e8fa58866cb9338a62d88/0a47e/service_worker_caution_2.png\"\n        srcset=\"/static/b6fdd58a142e8fa58866cb9338a62d88/8a4e8/service_worker_caution_2.png 150w,\n/static/b6fdd58a142e8fa58866cb9338a62d88/5a46d/service_worker_caution_2.png 300w,\n/static/b6fdd58a142e8fa58866cb9338a62d88/0a47e/service_worker_caution_2.png 600w,\n/static/b6fdd58a142e8fa58866cb9338a62d88/1cfc2/service_worker_caution_2.png 900w,\n/static/b6fdd58a142e8fa58866cb9338a62d88/c4b7c/service_worker_caution_2.png 903w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>express 환경에서 진행할 경우 <a href=\"http://localhost:7777/service-worker.js\">http://localhost:7777/service-worker.js</a> ~~~관련 에러가 뜰 경우 정적 파일을 찾지 못하는 것이기 때문에 express에서 아래 사진과 같이 설정해줘야 함</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 435px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/05a3a51c2ed235629e82a347fd4c5301/330eb/service_worker_caution_3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAuklEQVR42kWMwU6DQAAFdzmYqk0sZVEsgoGl3bIIFHCjpSY2sen//9EYuPQweZk5PLGsjwT9FWXPvFpH1p7YlD1J9UnlRnT7RWR6VtmBxI4o44jrH2Lzjf/ueHyrkS8l8tnMiPu04eljZFmc8MsLq/0fD/mRyI6k3Zmk/WURN4TbjqQaiExHbAfyxhEWLcoM3KUD3ny4R4S6YxHtEEGOCDLEOsMLt3iqQPiTT10jA33btZ67VJMXSHXjH/HBUYt4cQJiAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Service Worker Caution 3\"\n        title=\"\"\n        src=\"/static/05a3a51c2ed235629e82a347fd4c5301/330eb/service_worker_caution_3.png\"\n        srcset=\"/static/05a3a51c2ed235629e82a347fd4c5301/8a4e8/service_worker_caution_3.png 150w,\n/static/05a3a51c2ed235629e82a347fd4c5301/5a46d/service_worker_caution_3.png 300w,\n/static/05a3a51c2ed235629e82a347fd4c5301/330eb/service_worker_caution_3.png 435w\"\n        sizes=\"(max-width: 435px) 100vw, 435px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>만약 아래와 같이 cache.addAll에 대한 에러가 발생했다 캐시하는 목록들 중에서 404 error가 발생했기 때문이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/07e1966ac4e274704c643da465f9ea90/a1dd2/service_worker_caution_4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAYElEQVR42kWNywrEMAwD+/9/uSVLemn8SnoqnZJ4YQ9ikJDlTUtBPjtWvuAOvYNZ0gOig2r6iNTMZ8edO4KzHpy1Lm6roAbh0CQPRHJ8MaC135D/8/lElWcMLjOGCF2EF61SmhfRuM6VAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Service Worker Caution 4\"\n        title=\"\"\n        src=\"/static/07e1966ac4e274704c643da465f9ea90/0a47e/service_worker_caution_4.png\"\n        srcset=\"/static/07e1966ac4e274704c643da465f9ea90/8a4e8/service_worker_caution_4.png 150w,\n/static/07e1966ac4e274704c643da465f9ea90/5a46d/service_worker_caution_4.png 300w,\n/static/07e1966ac4e274704c643da465f9ea90/0a47e/service_worker_caution_4.png 600w,\n/static/07e1966ac4e274704c643da465f9ea90/a1dd2/service_worker_caution_4.png 838w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>네트워크 탭을 열어보면 취소된 내용 말고, index.html 404 Error가 보인다.\r\n해당 index.html을 가져오지 못하는 것이므로 경로 수정을 해주면 해결된다.</p>\n<p>index.html은 / 경로로 수정하면 해결된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6fab403132cd7428ad95e6b5ee5e6496/68de2/service_worker_caution_5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA+klEQVR42iWQ6W7EIAwG9/1fcY8m25AmHIYcS4BEnQr6wwKjkT0ft6/uGzUo5nlGRDjPk1IKuWSMNqSUsNa20xjbuKsyubAsS+udE/quZ9Sem9GOadb4ENjWjZzz/8CcMc6RcsaJZ1lXjLU47/kFSjmJ8UC8R8Tz1fdoLdzEWpZR4Wt5z3EcnM2wsE0/ZC+s88Qiwm4t+/DmM/REcY2JIbCLI7x7gquGxjAqxahGhkERY+S6rmap55l8HC1Wfa/s6/nkcb/jrG3Lp2lCnOP1eODrQO8cm9HstbaNlHKLW/+sbq6Rq1mKH1Zrkb5Dule7pxgb8wmBdVTN8A/Vy3v0Y/vuzwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Service Worker Caution 5\"\n        title=\"\"\n        src=\"/static/6fab403132cd7428ad95e6b5ee5e6496/0a47e/service_worker_caution_5.png\"\n        srcset=\"/static/6fab403132cd7428ad95e6b5ee5e6496/8a4e8/service_worker_caution_5.png 150w,\n/static/6fab403132cd7428ad95e6b5ee5e6496/5a46d/service_worker_caution_5.png 300w,\n/static/6fab403132cd7428ad95e6b5ee5e6496/0a47e/service_worker_caution_5.png 600w,\n/static/6fab403132cd7428ad95e6b5ee5e6496/68de2/service_worker_caution_5.png 677w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>수정한 결과는 다음과 같이 캐시 저장공간에 캐시할 파일들이 추가된 것을 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/43c33ea03e24c8b41217bffa7ac9ba0d/d52e5/service_worker_caution_6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABpElEQVR42p1S2a7dIAzk//+xL+ckYUvCTgIkZyo7vdVt1adaGgxesOWxkEpjcx4+RPiYEFKGWTeGMivW3WGWClIbvhu7wW47+2dtntyYGLsPEK/FYJ4m5Jxxnid67/DeI8aIbdtg7QqlNYw2iCkihABrLd7vCatznHMcByOUE+L1WqC1RggRrTVc18WfUQH6mPS8LOz7fD6/C9GHdKd4auIaA+loEBRE+C5fNrZ/gPu+H/s3330/+IonOfsN0VrnKq13nGd7dPtbD8ZxDtSD3h2dYmtFHwN9XBjXhdo6xCwN3tJglhpSW9jNQRnLg6c3EaOMxyIdFuUwLTuU3uG0wT4vcLuHTxkhJSZIvGaJHy/JLBJzzgfu9EHHcbZn6CeBCHjgQoSyzza8ZoVJO0itIYg1pRTWdWUGKbnWilIqSq3M4r+E5kajIk0x06I4T4wxEGJADAHOeWY7EcshoKSEI2fUnJllAiWXUlBLQaPuK61M5VUin6BjXS2MMdDaIGcKPDFKwSgZI2d0uo/ObBOoM8L9C9xUiLw+gqj/Y03+Q541uln/BHq2UfoX0T9iAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Service Worker Caution 6\"\n        title=\"\"\n        src=\"/static/43c33ea03e24c8b41217bffa7ac9ba0d/0a47e/service_worker_caution_6.png\"\n        srcset=\"/static/43c33ea03e24c8b41217bffa7ac9ba0d/8a4e8/service_worker_caution_6.png 150w,\n/static/43c33ea03e24c8b41217bffa7ac9ba0d/5a46d/service_worker_caution_6.png 300w,\n/static/43c33ea03e24c8b41217bffa7ac9ba0d/0a47e/service_worker_caution_6.png 600w,\n/static/43c33ea03e24c8b41217bffa7ac9ba0d/d52e5/service_worker_caution_6.png 848w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/36733d2766c9565b99e5ae6c8cc3047a/b2cef/service_worker_caution_7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABPUlEQVR42p1QQU7DMBDM/z/AAXGDfwASAglx7AEJURrbiZMmcezYiZ3UGeQVbTlwKSOtbK93Z2Y365RCCAEJhxjpbLsOTBSQ9R6yrtEpA+MCejvBWAtrHawbMaS7cxisgxks9DAgY4yDc4FpmnBEKSX2TYteG4yTp6ZE4n2gXBITRUk1oixR1Xt0qifSrGlbUooxUiRIKdG0HXLG8bndoiglFfswkwDjHF+7HKrvkTMGLgr4EBDmBVnTtJjnGcuynBxWVUXFKZKLJDgvCzVN3pObtBY3jtDGQPWa8uk/E0KQo3E8j1zX9WmvlyJjjEFrQ491XU8Oj4TH3G/8lTsRFnwHN2gs89mRUorW8C+Hb5scr5scH4VFZQCuIhrtf/Z6uDiyuxeH6weLm0eL22eHq3uLp/cBQERcVxrvkvgGlFO30PJdxy8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Service Worker Caution 7\"\n        title=\"\"\n        src=\"/static/36733d2766c9565b99e5ae6c8cc3047a/0a47e/service_worker_caution_7.png\"\n        srcset=\"/static/36733d2766c9565b99e5ae6c8cc3047a/8a4e8/service_worker_caution_7.png 150w,\n/static/36733d2766c9565b99e5ae6c8cc3047a/5a46d/service_worker_caution_7.png 300w,\n/static/36733d2766c9565b99e5ae6c8cc3047a/0a47e/service_worker_caution_7.png 600w,\n/static/36733d2766c9565b99e5ae6c8cc3047a/b2cef/service_worker_caution_7.png 847w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>대부분의 블로그나 service worker를 다루는 사이트에서 fetch 요청을 캐시할 때 다음과 같은 코드를 사용한다.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"97458338488514330000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"복사했습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`self.addEventListener(&quot;fetch&quot;, (event) => {\r\n  event.respondWith(\r\n    fetch(event.request).catch(() => {\r\n      return caches\r\n        .open(cacheName)\r\n        .then((cache) => cache.match(event.request));\r\n    })\r\n  );\r\n});`, `97458338488514330000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg stroke=\"currentColor\" fill=\"none\" stroke-width=\"2\" viewBox=\"0 0 24 24\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"h-4 w-4\" height=\"1em\" width=\"1em\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2\"></path><rect x=\"8\" y=\"2\" width=\"8\" height=\"4\" rx=\"1\" ry=\"1\"></rect></svg>\n              </div>\n            </div>\n<deckgo-highlight-code language=\"js\" terminal=\"carbon\" theme=\"blackboard\"  >\n          <code slot=\"code\">self.addEventListener(&quot;fetch&quot;, (event) =&gt; {\r\n  event.respondWith(\r\n    fetch(event.request).catch(() =&gt; {\r\n      return caches\r\n        .open(cacheName)\r\n        .then((cache) =&gt; cache.match(event.request));\r\n    })\r\n  );\r\n});</code>\n        </deckgo-highlight-code>\n<p>코드를 보면 잘 동작될 것 같은 코드지만, 내 환경에서는 동작하지 않았다.</p>\n<p><code>fetch(…).catch</code> 에 대한 에러가 발생했다.</p>\n<p>내가 생각한 이유는 fetch는 HTTP 통신 방법인데 나는 오프라인 환경에서 동작을 시켜야 했기 때문에 안됐던 것 같다.</p>\n<p>그래서 나는 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/FetchEvent/request\">MDN에서 제공하는 FetchEvent request 예제</a>를 사용했다.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"67552039459086790000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"복사했습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`// 요청이 올 때마다 가로채기\r\nself.addEventListener(&quot;fetch&quot;, (event) => {\r\n  console.log(&quot;fetch&quot;);\r\n  event.respondWith(\r\n    caches.match(event.request).then((response) => {\r\n      if (response) {\r\n        console.log(&quot;Found response in cache:&quot;, response);\r\n\r\n        return response;\r\n      }\r\n      console.log(\r\n        &quot;No response found in cache. About to fetch from network…&quot;\r\n      );\r\n\r\n      return fetch(event.request)\r\n        .then((response) => {\r\n          console.log(&quot;Response from network is:&quot;, response);\r\n\r\n          return response;\r\n        })\r\n        .catch((error) => {\r\n          console.error(&quot;Fetching failed:&quot;, error);\r\n\r\n          throw error;\r\n        });\r\n    })\r\n  );\r\n});`, `67552039459086790000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg stroke=\"currentColor\" fill=\"none\" stroke-width=\"2\" viewBox=\"0 0 24 24\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"h-4 w-4\" height=\"1em\" width=\"1em\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2\"></path><rect x=\"8\" y=\"2\" width=\"8\" height=\"4\" rx=\"1\" ry=\"1\"></rect></svg>\n              </div>\n            </div>\n<deckgo-highlight-code language=\"js\" terminal=\"carbon\" theme=\"blackboard\"  >\n          <code slot=\"code\">// 요청이 올 때마다 가로채기\r\nself.addEventListener(&quot;fetch&quot;, (event) =&gt; {\r\n  console.log(&quot;fetch&quot;);\r\n  event.respondWith(\r\n    caches.match(event.request).then((response) =&gt; {\r\n      if (response) {\r\n        console.log(&quot;Found response in cache:&quot;, response);\r\n\r\n        return response;\r\n      }\r\n      console.log(\r\n        &quot;No response found in cache. About to fetch from network…&quot;\r\n      );\r\n\r\n      return fetch(event.request)\r\n        .then((response) =&gt; {\r\n          console.log(&quot;Response from network is:&quot;, response);\r\n\r\n          return response;\r\n        })\r\n        .catch((error) =&gt; {\r\n          console.error(&quot;Fetching failed:&quot;, error);\r\n\r\n          throw error;\r\n        });\r\n    })\r\n  );\r\n});</code>\n        </deckgo-highlight-code>\n</li>\n</ol>\n<h3 id=\"참고\">참고</h3>\n<details>\r\n <summary>service worker</summary>\r\n    - 기업 기술 블로그에서 사용 예시\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"blackboard\"  >\n          <code slot=\"code\">https://fe-developers.kakaoent.com/2022/221208-service-worker/\r\n\r\n- 개인 블로그 설명\r\n\r\n[https://velog.io/@ouo_yoonk/PWA-Service-worker-그리고-캐시#http-cache와-service-workder-cache](https://velog.io/@ouo_yoonk/PWA-Service-worker-%EA%B7%B8%EB%A6%AC%EA%B3%A0-%EC%BA%90%EC%8B%9C#http-cache%EC%99%80-service-workder-cache)\r\n\r\nhttps://jdh5202.tistory.com/817 (참고하는데 도움 됨)\r\n\r\nhttps://shj.rip/bc900e3f-cc71-4a7e-b81d-3ffb8cdf6f37\r\n\r\nhttps://blog.arnellebalane.com/offline-web-applications-with-service-workers-29b23b49b305 (예시와 설명이 잘 되어 있음)\r\n\r\nhttps://somedaycode.github.io/develop/2021/03/12/cacheStorage/\r\n\r\n- web dev (구글 개발자들의 아티클)\r\n\r\nhttps://web.dev/i18n/ko/service-worker-caching-and-http-caching/\r\n\r\nhttps://developer.chrome.com/docs/workbox/modules/workbox-strategies/#cache-first-cache-falling-back-to-network\r\n\r\nhttps://web.dev/offline-cookbook/#serving-suggestions\r\n\r\nhttps://web.dev/service-workers-cache-storage/\r\n\r\n- MDN\r\n\r\nhttps://developer.mozilla.org/ko/docs/Web/API/Service_Worker_API\r\n\r\nhttps://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerGlobalScope/install_event\r\n\r\nhttps://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerGlobalScope/activate_event\r\n\r\nhttps://developer.mozilla.org/ko/docs/Web/API/ServiceWorker\r\n\r\nhttps://developer.mozilla.org/en-US/docs/Web/API/CacheStorage/delete\r\n\r\nhttps://developer.mozilla.org/en-US/docs/Web/API/FetchEvent/request\r\n\r\n- 문제 해결 참고\r\n\r\nhttps://stackoverflow.com/questions/47527223/a-bad-http-response-code-404-was-received-when-fetching-the-script\r\n\r\nhttps://stackoverflow.com/questions/39136625/service-worker-registration-failed\r\n\r\nhttps://stackoverflow.com/questions/66529102/uncaught-in-promise-typeerror-failed-to-execute-cache-on-addall-request</code>\n        </deckgo-highlight-code>\n</details>\r\n<details>\r\n  <summary>cache</summary>\r\n    - MDN\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"blackboard\"  >\n          <code slot=\"code\">https://developer.mozilla.org/en-US/docs/Web/API/Cache/delete\r\n\r\nhttps://developer.mozilla.org/en-US/docs/Web/API/CacheStorage/delete\r\n\r\nhttps://developer.mozilla.org/en-US/docs/Web/API/Cache/match\r\n\r\n- web dev\r\n\r\nhttps://web.dev/cache-api-quick-guide/#cacheaddall\r\n\r\n- 개인 블로그\r\n\r\n[https://velog.io/@chltjdrhd777/기업과제-회고-cache-storage-및-기타-고생내용](https://velog.io/@chltjdrhd777/%EA%B8%B0%EC%97%85%EA%B3%BC%EC%A0%9C-%ED%9A%8C%EA%B3%A0-cache-storage-%EB%B0%8F-%EA%B8%B0%ED%83%80-%EA%B3%A0%EC%83%9D%EB%82%B4%EC%9A%A9)\r\n\r\n[https://doinge-coding.tistory.com/entry/웹스토리지-IndexedDB-Cache-API](https://doinge-coding.tistory.com/entry/%EC%9B%B9%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80-IndexedDB-Cache-API)\r\n\r\nhttps://somedaycode.github.io/develop/2021/03/12/cacheStorage/</code>\n        </deckgo-highlight-code>\n</details>","frontmatter":{"title":"Service Worker Cache를 이용한 오프라인 환경 구축","slug":"blog/post/3","date":"2023년 08월 16일 ","thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/ff844dd7583b32d67caca70fb827a600/c9fe8/http_cache_flow.png","srcSet":"/static/ff844dd7583b32d67caca70fb827a600/c8dbc/http_cache_flow.png 211w,\n/static/ff844dd7583b32d67caca70fb827a600/4e113/http_cache_flow.png 423w,\n/static/ff844dd7583b32d67caca70fb827a600/c9fe8/http_cache_flow.png 845w","sizes":"(min-width: 845px) 845px, 100vw"},"sources":[{"srcSet":"/static/ff844dd7583b32d67caca70fb827a600/c5f53/http_cache_flow.webp 211w,\n/static/ff844dd7583b32d67caca70fb827a600/c882f/http_cache_flow.webp 423w,\n/static/ff844dd7583b32d67caca70fb827a600/39feb/http_cache_flow.webp 845w","type":"image/webp","sizes":"(min-width: 845px) 845px, 100vw"}]},"width":845,"height":618}}},"profile":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/22942bf5ef783d654325396c0a1ddcad/53973/JangTaemin2.png","srcSet":"/static/22942bf5ef783d654325396c0a1ddcad/22867/JangTaemin2.png 8w,\n/static/22942bf5ef783d654325396c0a1ddcad/7961d/JangTaemin2.png 15w,\n/static/22942bf5ef783d654325396c0a1ddcad/53973/JangTaemin2.png 30w,\n/static/22942bf5ef783d654325396c0a1ddcad/7ab40/JangTaemin2.png 60w","sizes":"(min-width: 30px) 30px, 100vw"},"sources":[{"srcSet":"/static/22942bf5ef783d654325396c0a1ddcad/5d252/JangTaemin2.webp 8w,\n/static/22942bf5ef783d654325396c0a1ddcad/f57b3/JangTaemin2.webp 15w,\n/static/22942bf5ef783d654325396c0a1ddcad/bde72/JangTaemin2.webp 30w,\n/static/22942bf5ef783d654325396c0a1ddcad/927d1/JangTaemin2.webp 60w","type":"image/webp","sizes":"(min-width: 30px) 30px, 100vw"}]},"width":30,"height":30}}}}}},"pageContext":{"slug":"blog/post/3"}},"staticQueryHashes":["3159585216","4283059873"],"slicesMap":{}}